cd /Users/sryu/projects/aionixone/openact/authflow && export AUTHFLOW_MASTER_KEY=4afb634d8774c347b1e4c8f5e6a9d2c8f7b3e1a4d6c9f2e5b8a1d4c7f0e3b6a9 && export AUTHFLOW_STORE=sqlite && export AUTHFLOW_SQLITE_URL=sqlite:/Users/sryu/projects/aionixone/openact/authflow/data/authflow.db && export GITHUB_CLIENT_ID=Ov23lihVkExosE0hR0Bh && export GITHUB_CLIENT_SECRET=9c704ca863eb45c8175d5d6bd9f367b1d17d8afc && echo "环境变量设置完成，启动服务器..." && RUST_LOG=info cargo run --features server,sqlite,encryption &

sleep 8 && curl -s http://localhost:8080/api/v1/health && echo "服务器已启动"

cd /Users/sryu/projects/aionixone/openact/authflow && WORKFLOW_RESPONSE=$(curl -s -X POST "http://localhost:8080/api/v1/workflows" -H "Content-Type: application/json" -d "{\"name\": \"GitHub OAuth2 Test\", \"description\": \"GitHub OAuth2 test\", \"dsl\": $(cat templates/providers/github/oauth2.json)}") && WORKFLOW_ID=$(echo "$WORKFLOW_RESPONSE" | jq -r '.id') && echo "工作流ID: $WORKFLOW_ID" && EXECUTION_RESPONSE=$(curl -s -X POST "http://localhost:8080/api/v1/executions" -H "Content-Type: application/json" -d "{\"workflowId\": \"$WORKFLOW_ID\", \"flow\": \"OAuth\", \"input\": {\"tenant\": \"test-tenant\", \"redirectUri\": \"http://localhost:8080/oauth/callback\"}, \"context\": {\"vars\": {\"secrets\": {\"github_client_id\": \"Ov23lihVkExosE0hR0Bh\", \"github_client_secret\": \"9c704ca863eb45c8175d5d6bd9f367b1d17d8afc\"}}}}") && EXECUTION_ID=$(echo "$EXECUTION_RESPONSE" | jq -r '.executionId') && echo "执行ID: $EXECUTION_ID"

EXECUTION_ID="d75f77da-be49-4de8-a700-7a552d87b16d" && sleep 3 && STATUS_RESPONSE=$(curl -s "http://localhost:8080/api/v1/executions/$EXECUTION_ID") && AUTHORIZE_URL=$(echo "$STATUS_RESPONSE" | jq -r '.context.states.StartAuth.result.authorize_url // empty') && if [ -n "$AUTHORIZE_URL" ]; then echo "🔗 授权URL: $AUTHORIZE_URL" && open "$AUTHORIZE_URL"; else echo "未找到授权URL"; fi

EXECUTION_ID="d75f77da-be49-4de8-a700-7a552d87b16d" && echo "监控执行状态..." && for i in {1..30}; do sleep 2; STATUS=$(curl -s "http://localhost:8080/api/v1/executions/$EXECUTION_ID" | jq -r '.status'); echo "[$i] 状态: $STATUS"; if [ "$STATUS" = "completed" ]; then echo "🎉 执行完成！"; break; elif [ "$STATUS" = "failed" ]; then echo "❌ 执行失败"; break; fi; done